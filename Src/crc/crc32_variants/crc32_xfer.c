/****************************************************************************
 *
 *   Copyright (c) 2023 IMProject Development Team. All rights reserved.
 *   Authors: Igor Misic <igy1000mb@gmail.com>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in
 *    the documentation and/or other materials provided with the
 *    distribution.
 * 3. Neither the name IMProject nor the names of its contributors may be
 *    used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
 * OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
 * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 *
 ****************************************************************************/

#include "crc32_xfer.h"

#include "crc32_base.h"

#define INITIAL_CRC32_VALUE (0x0U)
#define FINAL_XOR_VALUE (0x0U)
#define REFLECTED_OUTPUT (false)
#define REFLECTED_INPUT (false)
#define FINAL_XOR (false)

uint32_t
Crc32_xfer(
    const uint8_t* crc_data_ptr,
    uint32_t crc_length,
    const uint32_t* last_crc_ptr) {

    /* CRC32-XFER (Polynomial 0xAF) */
    static const uint32_t crc_table[256] = {
        0x00000000U, 0x000000AFU, 0x0000015EU, 0x000001F1U, 0x000002BCU, 0x00000213U, 0x000003E2U, 0x0000034DU,
        0x00000578U, 0x000005D7U, 0x00000426U, 0x00000489U, 0x000007C4U, 0x0000076BU, 0x0000069AU, 0x00000635U,
        0x00000AF0U, 0x00000A5FU, 0x00000BAEU, 0x00000B01U, 0x0000084CU, 0x000008E3U, 0x00000912U, 0x000009BDU,
        0x00000F88U, 0x00000F27U, 0x00000ED6U, 0x00000E79U, 0x00000D34U, 0x00000D9BU, 0x00000C6AU, 0x00000CC5U,
        0x000015E0U, 0x0000154FU, 0x000014BEU, 0x00001411U, 0x0000175CU, 0x000017F3U, 0x00001602U, 0x000016ADU,
        0x00001098U, 0x00001037U, 0x000011C6U, 0x00001169U, 0x00001224U, 0x0000128BU, 0x0000137AU, 0x000013D5U,
        0x00001F10U, 0x00001FBFU, 0x00001E4EU, 0x00001EE1U, 0x00001DACU, 0x00001D03U, 0x00001CF2U, 0x00001C5DU,
        0x00001A68U, 0x00001AC7U, 0x00001B36U, 0x00001B99U, 0x000018D4U, 0x0000187BU, 0x0000198AU, 0x00001925U,
        0x00002BC0U, 0x00002B6FU, 0x00002A9EU, 0x00002A31U, 0x0000297CU, 0x000029D3U, 0x00002822U, 0x0000288DU,
        0x00002EB8U, 0x00002E17U, 0x00002FE6U, 0x00002F49U, 0x00002C04U, 0x00002CABU, 0x00002D5AU, 0x00002DF5U,
        0x00002130U, 0x0000219FU, 0x0000206EU, 0x000020C1U, 0x0000238CU, 0x00002323U, 0x000022D2U, 0x0000227DU,
        0x00002448U, 0x000024E7U, 0x00002516U, 0x000025B9U, 0x000026F4U, 0x0000265BU, 0x000027AAU, 0x00002705U,
        0x00003E20U, 0x00003E8FU, 0x00003F7EU, 0x00003FD1U, 0x00003C9CU, 0x00003C33U, 0x00003DC2U, 0x00003D6DU,
        0x00003B58U, 0x00003BF7U, 0x00003A06U, 0x00003AA9U, 0x000039E4U, 0x0000394BU, 0x000038BAU, 0x00003815U,
        0x000034D0U, 0x0000347FU, 0x0000358EU, 0x00003521U, 0x0000366CU, 0x000036C3U, 0x00003732U, 0x0000379DU,
        0x000031A8U, 0x00003107U, 0x000030F6U, 0x00003059U, 0x00003314U, 0x000033BBU, 0x0000324AU, 0x000032E5U,
        0x00005780U, 0x0000572FU, 0x000056DEU, 0x00005671U, 0x0000553CU, 0x00005593U, 0x00005462U, 0x000054CDU,
        0x000052F8U, 0x00005257U, 0x000053A6U, 0x00005309U, 0x00005044U, 0x000050EBU, 0x0000511AU, 0x000051B5U,
        0x00005D70U, 0x00005DDFU, 0x00005C2EU, 0x00005C81U, 0x00005FCCU, 0x00005F63U, 0x00005E92U, 0x00005E3DU,
        0x00005808U, 0x000058A7U, 0x00005956U, 0x000059F9U, 0x00005AB4U, 0x00005A1BU, 0x00005BEAU, 0x00005B45U,
        0x00004260U, 0x000042CFU, 0x0000433EU, 0x00004391U, 0x000040DCU, 0x00004073U, 0x00004182U, 0x0000412DU,
        0x00004718U, 0x000047B7U, 0x00004646U, 0x000046E9U, 0x000045A4U, 0x0000450BU, 0x000044FAU, 0x00004455U,
        0x00004890U, 0x0000483FU, 0x000049CEU, 0x00004961U, 0x00004A2CU, 0x00004A83U, 0x00004B72U, 0x00004BDDU,
        0x00004DE8U, 0x00004D47U, 0x00004CB6U, 0x00004C19U, 0x00004F54U, 0x00004FFBU, 0x00004E0AU, 0x00004EA5U,
        0x00007C40U, 0x00007CEFU, 0x00007D1EU, 0x00007DB1U, 0x00007EFCU, 0x00007E53U, 0x00007FA2U, 0x00007F0DU,
        0x00007938U, 0x00007997U, 0x00007866U, 0x000078C9U, 0x00007B84U, 0x00007B2BU, 0x00007ADAU, 0x00007A75U,
        0x000076B0U, 0x0000761FU, 0x000077EEU, 0x00007741U, 0x0000740CU, 0x000074A3U, 0x00007552U, 0x000075FDU,
        0x000073C8U, 0x00007367U, 0x00007296U, 0x00007239U, 0x00007174U, 0x000071DBU, 0x0000702AU, 0x00007085U,
        0x000069A0U, 0x0000690FU, 0x000068FEU, 0x00006851U, 0x00006B1CU, 0x00006BB3U, 0x00006A42U, 0x00006AEDU,
        0x00006CD8U, 0x00006C77U, 0x00006D86U, 0x00006D29U, 0x00006E64U, 0x00006ECBU, 0x00006F3AU, 0x00006F95U,
        0x00006350U, 0x000063FFU, 0x0000620EU, 0x000062A1U, 0x000061ECU, 0x00006143U, 0x000060B2U, 0x0000601DU,
        0x00006628U, 0x00006687U, 0x00006776U, 0x000067D9U, 0x00006494U, 0x0000643BU, 0x000065CAU, 0x00006565U
    };

    uint32_t crc_initial_value = INITIAL_CRC32_VALUE;

    if (NULL_PTR != last_crc_ptr) {
        crc_initial_value = *last_crc_ptr;
    }

    return Crc32Base(
               crc_table,
               crc_data_ptr,
               crc_length,
               crc_initial_value,
               FINAL_XOR_VALUE,
               REFLECTED_OUTPUT,
               REFLECTED_INPUT,
               FINAL_XOR
           );
}
